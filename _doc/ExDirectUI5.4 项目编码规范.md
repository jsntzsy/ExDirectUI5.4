ExDirectUI 5.3 项目编码规范

# 一、整体规则

## 1. 本项目参考Google的C++项目命名规范，在此基础上根据实际编码情况稍作微调。基本遵循如下规则：

a. 编码风格保持与项目中其他代码文件的风格统一

b. 命名应具有描述性，除常用简写外尽量避免使用简写

c.使用英文编写，不得使用拼音或中文（注释除外）

## 2. 术语说明：

**小驼峰命名法：** 首单词全小写，其他单词首字母大写，单词之间不使用分隔符，如`systemVersion`

**帕斯卡命名法（大驼峰命名法）：** 所有单词首字母大写，单词之间不使用分隔符，如`SystemVersion`

**下划线命名法：** 所有单词全部小写，单词间使用下划线分隔，如`system_version`

**常量命名法：** 所有单词全部大写，单词之间使用下划线分隔，如`SYSTEM_VERSION`

**匈牙利命名法：** 以变量类型及数据类型作为前缀，后跟变量描述，变量描述部分一般采用帕斯卡命名法，如`g_dwSystemVersion`

# 二、项目文件结构

## 1. 文件及目录命名规范

项目根目录以首字母大写形式命名，命名逻辑遵循：ExDirectUI [.类别] [.特点]，如ExDirectUI.Render.Direct2D

项目分类目录以首字母大写命名，如Debug

私有目录及文件（不同步至GitHub）以双下划线开头，可以使用下划线命名法，如__build

项目内目录均以下划线命名法命名，如system_info

代码文件均以下划线命名法命名，如system_info.h

## 2. 代码文件类型包含但不限于以下格式：

- C++源文件：以.cpp或.cc结尾
- C语言源文件：以.c结尾
- C/C++头文件：以.h结尾
- C++头源文件：以.hpp结尾
- 引入文本文件：以.inc结尾
- 导出函数定义文件：以.def结尾

## 3. 代码字符编码格式

为方便GitHub或VSCode等程序正常显示，同时兼容MSVC编译器正常编译，所有个人编写的代码文件均采用UTF-8带BOM头的字符编码格式。TXT、XML等文本类文件根据要求独立设置字符编码格式

## 4. 项目解决方案目录层级结构

- ExDirectUI5.3 解决方案根目录
   - ExDirectUI 主项目目录
       - include 公开头文件导入目录
          - common 通用公开头文件目录
          - kernel 内核层公开头文件目录
          - drawing 渲染层公开头文件目录
          - … 等等
       - src 源码文件目录
          - kernel 内核层代码文件目录
          - drawing 渲染层代码文件目录
          - … 等等
   - Debug 调试项目分类目录
       - ExDirectUI.Debug.WinFrom 窗口调试项目根目录
       - ExDirectUI.Debug.UnitTest 单元测试项目根目录
       - … 等等
   - Drawing 渲染层项目分类目录
       - ExDirectUI.ImageCodec.GdiPlus GDI+图像解码器
       - ExDirectUI.Render.Direct2D Direct2D渲染器
       - … 等等
   - Resources 资源文件目录
       - \__private 私有资源目录
   - \__build 生成文件目录
   - \__output 输出文件目录
   - ThirdParts 第三方项目分类目录
   - … 等等

# 三、代码命名规则

## 1. 数据类型

使用帕斯卡命名法；

公开的数据类型一般以Ex开头，如`ExImageInfo`

私有的数据类型一般以_Ex开头，如`_ExImageDetails`

数据类型成员使用下划线命名法，如`image_width`

## 2. 接口

使用class定义接口；

使用帕斯卡命名法，以IEx开头，如`IExImageBrush`

## 3. 类

使用class定义类；

使用帕斯卡命名法，一般以Ex开头，如`ExImageBrush`

## 4. 模板实现类

使用class定义类；

使用帕斯卡命名法，一般以Ex开头、Impl结尾，如`ExImageBrushImpl`

## 5. 函数

全局函数使用帕斯卡命名法；

公开导出的函数命名规则一般为：Ex[功能前缀][动词][介词][名次]，如`ExImageGetSize`

私有函数一般以下划线开头，如`_ExModuleLoadFromHandle`

私有的类成员函数一般以下划线开头，如`_SetState`

保护性私有成员函数一般以双下划线开头，如`__Destroy`

子类实现功能的函数一般以Do开头，如`DoProcess`

类内事件函数一般以On开头，如`OnClick`

## 6. 变量

变量命名规则一般为：[形容词_][形容词_]名词

局部变量使用下划线命名法命名，如`window_state`

局部静态变量与局部变量命名规则相同

函数形参使用下划线命名法命名，如`window_state`

类成员变量使用下划线命名法命名，并以m_开头，如`m_window_state`

全局变量使用下划线命名法命名，并以g_开头，属于特定模块的话需要跟上模块名，如`g_engine_instance`

全局静态变量使用下划线命名法命名，并以s_开头，属于特定模块的话需要跟上模块名，如`s_module_count`

## 8. 常量

枚举类型使用帕斯卡命名法，一般以Ex开头，如`ExEngineStatus`

枚举值使用常量命名法，并留有相同前缀，如`ES_LOAD_FAILED`

## 9. 宏 （不建议使用）

宏常量命名方式与常量值一致

宏命令的参数使用英文缩写，并全部大写

## 10. 类型别名

基本类型别名使用常量命名法，一般以EX开头，如`EXATOM`

函数指针类型别名使用帕斯卡命名法，以Ex开头、Proc结尾，如`ExEnumItemProc`

# 四、注释规范

## 1. 总体规范

代码中注释内容包括如下部分：

 1. 文档注释：用于生成文档及导出函数列表等数据，本项目以doxygen生成文档，故文档注释均采用Doxygen的文档注释语法，单行使用///开头，多行使用/\*\*开头，具体语法详见下文
 2. 使用说明注释：用于说明该变量或函数的用途或使用方式，一般用于内部使用的变量或函数，如`// 引擎宿主实例句柄 `
 3. 备忘录注释：用于标记该变量、函数或代码段中使用到的临时代码、存在的问题、待开发项等，一般以[大写备忘类型]开头，如`// [FIXME] 这里代码未完善`
 4. 代码逻辑注释：用于标识该行或该段代码的执行逻辑或编码思路，一般注释独占一空行，放在代码段上方，尽量不放在代码行尾部，文字较多的使用多行注释表达，可放置参考资料，如文档链接等

## 2. 文件头部注释

项目内个人编写的代码文件（C/C++头文件、源文件等），均需编写文件头注释，用于Doxygen生成文档，同事也便于代码复查和阅读者理解文件作用

**注释格式如下：**
```
/**
* @file 文件名（必填）
* @brief 简介（必填）
* @details 细节
* @mainpage 工程概览
* @author 作者（必填）
* @email 邮箱
* @version 当前版本号（必填）
* @date 更新日期 年-月-日（必填）
* @copyright 授权
* @link 参考链接
*/
```

## 3. 全局变量注释

全局变量注释主要备注该变量的用途及定义文件位置，同时可标记特殊标记（如不应写等），注释一般放在变量定义行上方；

**整体形式如下：**

```
// 全局变量：引擎实例句柄 定义于 kernel/engine.cpp中 [不应改写]
HINSTANCE g_Engine_hInstance;
```

## 4. 枚举常量、宏注释

枚举类型注释一般用Doxygen文档语法，注释其枚举类型中文名及说明；

枚举值一般用Doxygen文档语法，注释其中文名、说明及标识；

宏常量注释语法与枚举值语法一致；

宏函数一般仅需注释其功能；

**注释格式如下：**

```
/// 引擎状态码
enum ExStatus
{
    ES_OK = 0x00000000, ///\< 状态：正常
    ES_FALSE = 0x00000001, ///\< 状态：返回假
};

#define WM_CLICK 0x00010001 ///\< 消息：点击

// 取A和B中大的一个
#define MAX(A,B) (A\>B?A:B)
```

## 5. 自定义数据结构注释

自定义数据类型一般用Doxygen文档语法，注释结构体中文名及说明；

数据类型成员一般用Doxygen文档语法，注释其中文名、说明及标识，一般放在成员上方空行；

**注释格式如下：**

```
/// 图像信息
struct ExImageInfo
{
    /// 图片宽度
    int width;

    /// 图片高度
    int height;

    /// 图片标识 \#\*EIF_,图片标识_\#
    dword_t flags;
}
```

## 6. 函数及参数注释

所有导出的函数接口均需编写函数注释，用于Doxygen生成导出函数文档。

**注释格式如下：**

```
/**
* @brief 函数简介（必填）
* 详细说明
* @param 形参 参数说明（必须与参数一致）
* @return 返回说明（必须与返回值一致）
* @retval 返回值说明
* @note 注解
* @attention 注意
* @warning 警告
* @exception 异常
* @see 参考
* @class 引用类 用于文档生成连接
* @enum 引用枚举 用于文档生成连接
* @code 代码块开始 与@endcode成对使用
* @endcode 代码块结束 与@code成对使用
* @bug 缺陷 链接到所有缺陷汇总的缺陷列表
* @todo TODO 链接到所有TODO 汇总的TODO 列表
* @example 使用例子说明
* @remarks 备注说明
* @pre 函数前置条件
* @deprecated 函数过时说明
*/
```

## 7. 代码块注释

代码行或代码块的注释应遵循以下规则：

 1. 注释应该清晰地描述代码的用途、功能和设计思路，帮助代码阅读者理解代码。
 2. 注释应该使用规范的格式，使其易于阅读和理解。
 3. 注释应该包括必要的信息，但不要过度注释。注释应该解释代码的意图，而不是简单地重复代码本身。
 4. 注释应该与其描述的代码紧密相关，通常位于代码上方或右侧。对于复杂的代码块，可以在代码内部使用注释。
 5. 代码修改后，注释也应该相应更新。过时的注释可能会导致误解或混淆。
 6. 注释应该使用清晰简洁的语言，避免使用技术性术语或难以理解的缩写。

总的原则是注释应该提供给代码阅读者足够的信息，以便理解代码的意图和设计，但不应该过度注释或重复代码。好的注释应该是简洁、清晰和易于理解的。


# 五、编码风格

## 1. 函数的参数顺序

参数的顺序应尽量遵循如下规则：

 - 输入参数在前，输出参数在后
 - 核心参数在前，细节参数在后
 - 在设计参数列表时，应考虑后期的扩展可能性，扩展参数时应当尽量避免影响原参数列表
 - 输入参数一般为值类型或常量引用类型，尽量避免
 - 输出参数一般为非常量的指针类型

## 2. 适当使用函数重载

 - 内部使用的全局函数、类成员函数、构造函数均可根据用途适当进行函数重载
 - 导出的函数不允许进行函数重载，若需提供不同参数版本的，应区分函数名

## 3. 内联函数

 - 对于简单常用的函数代码，可以定义内联函数
 - 全局内联函数可以定义在头文件内
 - 内联函数内容不应过于复杂，理论上单个内联函数不得超过10行
 - 内联函数内不应当包含循环或switch语句

## 4. 代码行宽度


## 5. 头文件

头文件一般包含顺序为： 预编译头文件 > C语言库 > C++库 > 系统库 > 第三方库 > 项目内头文件

 - 使用 `#include <xxx.h>` 来包含标准库、系统库的头文件
 - 使用 `#include "xxx.h"` 来包含其他的文件

头文件内不包含除全局内联函数和类成员变量初始值外的所有定义，仅作声明

尽量使用前置声明，尽可能不要在头文件中包含其他头文件，防止依赖

## 6. 变量初始化

 - 状态码等需要编译器检查提醒未赋值错误的情况下可不赋初始值
 - 其他情况必须在变量定义时就赋初始值



